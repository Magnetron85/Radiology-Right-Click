# Radiology Right Click v1.04
(c) 2024, GitHub user Magnetron85

## Description
Radiology Right Click v1.04 is a radiologist's quantitative friend, designed to improve quantitative radiology and streamline workflow. This AutoHotkey script provides a suite of tools accessible via right-click in PowerScribe at the point of dictation, offering quick calculations and reference information for various radiological measurements and assessments. The script should be easily modifiable for non-PowerScribe environments.

It works by highlighting text in PowerScribe360 as installed at the authors institution or NotePad for troubleshooting.

If a user desires OCR of coronary calcium scoring, download Vis2 OCR for AHK. https://github.com/iseahound/Vis2. If do not desire, can disable in preferences. Download this and place in same folder as the Right Click excecutable file.

The user highlights text and right clicks with the mouse. A new right click menu appears in PowerScribe or NotePad with various useful functions. 
The script can be paused to see the default right click menu for a specified time - 3 minutes default and up to 10 hours to turn off for an entire shift. 

Users can hide calculators that are infrequently or not used. Preferences are saved in a preferences.ini which is created in the script directory if preferences are edited.

Suggested usage: make Powerscribe templates that match input of this script to ensure no formatting issues at runtime.

## Author
Created by an amateur programming enthusiast with a passion for radiology, in partnership with Claude, an AI assistant.
Contributions for Fleischner by: Eric Van Bogaert (https://github.com/EricVanBogaert/AutoHotKey-for-Radiology) who made an excellent AutoHotKey v2 script which was translated to v 1.1 by Claude v3.5 sonnet. 

## Features
- Coronary Artery Calcium Score Percentile Calculator (MESA and Hoff methods)
- Ellipsoid Volume Calculator
- Bullet Volume Calculator
- PSA Density Calculator
- Pregnancy Date Calculator
- Menstrual Phase Estimator
- Adrenal Washout Calculator
- Thymus Chemical Shift Calculator
- Hepatic Steatosis Estimator (based on Serlin. Radiology. 2009-IP/OP. Not more accurate PDFF which would use "statistics" function to compute averages)
- MRI Liver Iron Content Estimator (need R2* dataset)
- Nodule Size Comparison and Sorting (Sorting takes in 3 comma separated numbers and returns in descending order separated by x to improve formatting of ModLink fields containing 3 comma separated values).
- Number statistics
- Measurement formatting correction 
- OCR for coronary calcium scoring (BETA) - Tested with syngo.via. 
- Fleischner 2017 recomendations on per nodule basis.


## Usage and Installation

The script does not require installation on a hospital owned workstation. You may or may not have permission to download .exe files. 

Pathway #1: 
1.) Download the .exe file from GitHub. 
2.) Double click to run. 
3.) If you do not have permission to download .exe files, download on a personal computer and place on USB stick. Then plug into computer, double click and run.

Pathway #2:
1) Download AutoHotKey v 1.1 on a PC that you have permission to install software (often a personal PC)
2) Download script fron GitHub on the same PC you installed AutoHotKey v 1.1
3) Compile script. 
2a) Optional: Place the generated exe file on a usb stick to transfer to PACS workstation
2b) Optional: Plug usb stick into PACS work station
3) Start the script by double clicking the exe file generated by the AutoHotKey v 1.1 Compiler
4) Highlight text to process in PowerScribe360 (or NotePad in test environment) 
5) Right-click on mouse, select a menu choice.
6) Functions return results in message boxes with output also pasted to your clipboard. Input format is (usually) preserved on the clipboard to allow you to directly paste into reports with minimal editing.
7) To turn off the script, click "Show Hidden Icons" on Windows taskbar (^ carrot), Find the Green letter H indicating an AutoHotKey script is running, right click on the script and select "exit"

Troubleshooting: 
1) Ensure you are only running one instance of the script if there is unexpected behavior by going to the "Show Hidden Icons" in the Windows Task Bar and making sure only 1 green letter H is present. Exit duplicate instances as needed.
2) Ensure your running instance of powerscribe has the same name as one of the options on line #92 in code. If you would like another program to have access, add it to that line.



## Status
This project is currently in testing and development. We are aware of several areas for improvement:
- Global variables need to be cleaned up (removed) for better code organization
- Local machine learning functions could be implemented for improved text processing and variable extraction
- Potential for automatic impression generation based on findings




## Sample Inputs (Highlight this text in NotePad or PowerScribe, right click while highlighted). 

### Calcium Score Percentile
Description: calculates  age and sex matched coronary artery calcifiction percentile (Hoff dataset). Also takes into account race if provided (MESA dataset; races supported based on MESA: Black, Chinese, Hispanic and White). The MESA data set currently requires an external call to their website to obtain the percentile information. The function also calculates arterial age.
```
Age: 56
Sex: Male
Race: White
YOUR CORONARY ARTERY CALCIUM SCORE: 56 (Agatston)
```
OR
```
Age: 56
Sex: Male
YOUR CORONARY ARTERY CALCIUM SCORE: 56 (Agatston)
```

### Ellipsoid and Bullet Volume
```
3.5 x 2.6 x 4.1 cm
```
OR
```
4 x 3 x 4 mm
```
OR
```
3.5 x 2.6 x 4.1 (assumes cm with decimals, assumes mm with whole numbers)
```

### PSA Density
```
PSA level: 4.5 ng/mL, Prostate volume: 30 cc
```

### Pregnancy Dates
Description: calculates LMP, current gestational age, and expected delivery date based on various inputs
```
LMP: 01/15/2023
```
OR
```
GA: 12 weeks and 3 days as of today
```
OR
```
GA: 12 weeks and 3 days as of 01/01/2021
```
OR
```
Gestational Age: 12w3d (if no date, assumes todays date)
```

### Menstrual Phase
Description: calculates the current date of menstrual cycle based on a 28 day cycle. Provides expected stripe thickness (there is considerable variability in stripe thickness, and this is general information.).

```
LMP: 05/01/2023
```

### Adrenal Washout
Description: calculates absolute and relative washout. Takes into account, intrinsic density and provides useful recommendations based on Hounsfield unit less than 10 or greater than 43.
```
Unenhanced: 10 HU, Enhanced: 80 HU, Delayed: 40 HU
```
OR
```
Enhanced: 80 HU, Delayed: 40 HU
```


### Thymus Chemical Shift
Description: Calculates thymic chemical shift ratio and/or signal intensity index. Cut off set to CSR 0.849 and SII 8.92% according to reference provided (if preference enabled to show reference). 
```
Thymus IP: 100, OP: 80, Paraspinous IP: 90, OP: 85
```
OR
```
Thymus IP: 100, OP: 80
```


### Hepatic Steatosis
Description: Gross assessment of liver fat fraction According to Claud Serlins 2009 invited commentary. Note: this is not PDFF. PDFF typically is obtained by obtaining 4 meaurements on a dedicated series and taking an average. This can be accomplished using the statistics function. 
```
Liver IP: 100, OP: 80, Spleen IP: 90, OP: 88
```
OR
```
Liver IP: 100, OP: 80
```


### MRI Liver Iron Content
Description: A handy tool to calculate estimated mg Fe / g dry liver according to most recently known normalization functions (reference provided in output if preference is selected)
```
1.5T, R2*: 50 Hz
```


### Nodule Size Comparison
Description: takes in 1, 2 or 3 measurements for a single lesion and calculates change in longest dimension, area and ellipsoid volume. Absolute numbers and percent change are displayed. If dates are supplied, doubling time and exponential growth rate are displayed. For 1D comparisons, a lesion is assumed to be a sphere and volumes of spheres are compared. For 2D comparisons, a third dimension is imputed as the average of the first two dimensions and volumes of resulting ellipsoids are compared. For 3D dimensions, ellipsoid equation is used to comapre volumes. If one date is given, it is assumed that is the prior date and current date is taken as of today. 
```
previous 3.5 x 2.6 cm  now 4.1 x 2.9 cm
```
OR 
```
4.1 x 2.9 x 3.3 cm (previously 3.9 x 2.8 x 3.0 cm)
```
OR
```
4.1 cm, previously 3.9 cm
```
OR
```
4.1 cm, previously 3.9 cm on 01/01/2000
```
OR
```
4.1 x 3.8 cm, previously 3.9 x 3.0 cm on 01/01/2000
```
OR
```
4.1 cm on 06/01/2000, previously 3.9 cm on 01/01/2000
```

### Sort measurement sizes 
Descriptions: Takes in 2 or 3 numbers, sorts into descending order and separates by an "x" The function works for any number of inputs- ie a paragraph with 3 separate lesions will be treated independently and sorted appropriately. 
```
3.5 x 2.6 x 4.2 cm -->  4.2 x 3.5 x 2.6 cm 
```
OR
```
(3,4,7) --> 7 x 4 x 3

### Calculate number range 
Description: Takes in any number of digits with any seperator and outputs the smallest number and largest number separated by a "-"
```
3,12,5
```
OR
```
3.5 4.2 5.5
```

### Calculate statistics (takes in any number of digits)
```
Returns various statistics meaningful to daily practice. More statistics are returned for larger datasets.
```

```
### Calculate premedication
```
User enters date and time of scan in GUI (defaulted to 13 hours in future). Function returns time, medication and dosage for contrast allergy premedication per ACR contrast manual.


### Calculate Fleischner
Adapted from https://github.com/EricVanBogaert/AutoHotKey-for-Radiology. Thank you Eric Van Bogaert! 
To use, highlight a sentence in a radiology report and right click. It will display a message box with nodule descriptors and copy the recommendation into the report at the end of the highlighted sentence.

This uses a heuristic approach to analyzing the language, so it may not work for all cases. Some important caveats:
- It accepts 1-3 measurements separated by "x" with optional spaces. Must have "mm" or "cm" at the end e.g. 1.0 x 2.0 x 3.0 cm, 1.0x2.0 mm, or 1 mm
- It will always use the single number or average of the two largest measurements for Fleischner category. 
- It will always categoirize a calcified nodule as benign and not recommend follow-up
- If the sentence contains "solid" and "ground glass" descriptors, it will consider it a part-solid nodule

Examples of well-formed sentences:
"Incidental right upper lobe solid noncalcified pulmonary nodule measuring 7 x 8 mm (series 1, image 30)."
"Multiple bilateral groundglass pulmonary nodules, largest measuring 1.5 x 1.5 cm in the left lower lobe."
"Part solid nodule in the right middle lobe with groundglass and solid components. 
    The solid component measures 6 x 4 x 8 mm."


## Contributions
Contributions, suggestions, and bug reports are welcome. Please open an issue or submit a pull request on GitHub. We're particularly interested in contributions that address our planned future improvements or add new calculation packages for various radiology subspecialties, including nuclear medicine. We also welcome innovative solutions for implementing advanced text processing capabilities within the constraints of hospital security protocols, including spelling and grammar checking, dictation error detection, and medical abbreviation expansion. Contributions to the development of RADS modules and decision support algorithms are highly encouraged. We are also seeking contributors for translations and localization to expand the tool's accessibility to non-English speaking radiologists. Expertise in PACS integration, EHR systems, automated data capture, and natural language processing would be especially valuable for implementing the automated measurement capture and note parsing systems.

## License

Radiology Right Click v1.0 is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.

## Disclaimer
This software is provided for educational and research purposes only. It should not be used as a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition. Users should exercise caution and verify all calculations for patient safety. While the RADS modules aim to assist in classification and reporting, the final interpretation and clinical decisions should always be made by qualified healthcare professionals. The automated measurement capture and note parsing features are designed to assist radiologists but should not replace careful review and validation of all information in the final report. Users are responsible for ensuring the accuracy and appropriateness of all auto-populated content. It is the responsibility of the user of this software, not the software or developer, to ensure accurate calculations.
